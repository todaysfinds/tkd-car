{% extends "base.html" %}

{% block page_title %}í•™ë¶€ëª¨ ìš”ì²­{% endblock %}

{% block content %}
<div class="px-4 py-4">
    <div class="card p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">ì°¨ëŸ‰ ìš´í–‰ ìš”ì²­</h2>
        
        <form method="POST" class="space-y-6">
            <!-- ìë…€ ì„ íƒ -->
            <div>
                <label for="student_id" class="block text-sm font-medium text-gray-700 mb-2">
                    ìë…€ ì„ íƒ <span class="text-red-500">*</span>
                </label>
                <select name="student_id" id="student_id" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">ìë…€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    {% for student in students %}
                    <option value="{{ student.id }}">{{ student.name }} ({{ student.grade or 'í•™ë…„ ë¯¸ë“±ë¡' }})</option>
                    {% endfor %}
                </select>
            </div>

            <!-- ìš”ì²­ ìœ í˜• -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    ìš”ì²­ ìœ í˜• <span class="text-red-500">*</span>
                </label>
                <div class="space-y-3">
                    <label class="flex items-start space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="request_type" value="absence" class="mt-1" required>
                        <div>
                            <div class="font-medium text-gray-900">ê²°ì„</div>
                            <div class="text-sm text-gray-600">ì•„í””, ì—¬í–‰ ë“±ìœ¼ë¡œ í•™ì›ì— ì˜¤ì§€ ì•ŠìŒ</div>
                        </div>
                    </label>
                    
                    <label class="flex items-start space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="request_type" value="pickup_skip" class="mt-1" required>
                        <div>
                            <div class="font-medium text-gray-900">ì§ì ‘ ë“±ì›</div>
                            <div class="text-sm text-gray-600">ì°¨ëŸ‰ í”½ì—… ì—†ì´ ì§ì ‘ ë°ë ¤ë‹¤ ì£¼ê² ìŒ</div>
                        </div>
                    </label>
                    
                    <label class="flex items-start space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                        <input type="radio" name="request_type" value="dropoff_skip" class="mt-1" required>
                        <div>
                            <div class="font-medium text-gray-900">ë„ì¥ í”½ì—…</div>
                            <div class="text-sm text-gray-600">ì°¨ëŸ‰ í•˜ì°¨ ì—†ì´ ë„ì¥ì—ì„œ ì§ì ‘ ë°ë ¤ê°€ê² ìŒ</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- ì‚¬ìœ  ì„ íƒ (ê²°ì„ì‹œì—ë§Œ í‘œì‹œ) -->
            <div id="reasonSection" class="hidden">
                <label for="reason" class="block text-sm font-medium text-gray-700 mb-2">
                    ì‚¬ìœ 
                </label>
                <select name="reason" id="reason"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                    <option value="ì•„í””">ì•„í””</option>
                    <option value="ì—¬í–‰">ì—¬í–‰</option>
                    <option value="ê°œì¸ì‚¬ì •">ê°œì¸ì‚¬ì •</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                </select>
            </div>

            <!-- ë‚ ì§œ ì„ íƒ -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="start_date" class="block text-sm font-medium text-gray-700 mb-2">
                        ì‹œì‘ì¼ <span class="text-red-500">*</span>
                    </label>
                    <input type="date" name="start_date" id="start_date" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="end_date" class="block text-sm font-medium text-gray-700 mb-2">
                        ì¢…ë£Œì¼ <span class="text-xs text-gray-500">(ë‹¨ì¼ì¼ ê²½ìš° ë¹„ì›Œë‘ )</span>
                    </label>
                    <input type="date" name="end_date" id="end_date"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>

            <!-- ë©”ëª¨ -->
            <div>
                <label for="memo" class="block text-sm font-medium text-gray-700 mb-2">
                    ì¶”ê°€ ë©”ëª¨
                </label>
                <textarea name="memo" id="memo" rows="3" placeholder="ì¶”ê°€ë¡œ ì „ë‹¬í•  ë‚´ìš©ì´ ìˆìœ¼ë©´ ì‘ì„±í•´ì£¼ì„¸ìš”"
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
            </div>

            <!-- ì¶œì„ìœ¼ë¡œ ë³€ê²½ ì•ˆë‚´ -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-start space-x-2">
                    <span class="text-blue-500">ğŸ’¡</span>
                    <div class="text-sm text-blue-700">
                        <p class="font-medium mb-1">ì¶œì„ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²½ìš°</p>
                        <p>ê²°ì„ ì‹ ì²­ í›„ ë‹¤ì‹œ ì¶œì„í•˜ê²Œ ë˜ëŠ” ê²½ìš°, ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì¶œì„ ìš”ì²­ì„ ë‹¤ì‹œ ì œì¶œí•´ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            </div>

            <!-- ì œì¶œ ë²„íŠ¼ -->
            <div class="flex space-x-3">
                <button type="button" onclick="history.back()" 
                        class="flex-1 btn-secondary">
                    ì·¨ì†Œ
                </button>
                <button type="submit" class="flex-1 btn-primary">
                    ìš”ì²­ ì œì¶œ
                </button>
            </div>
        </form>
    </div>

    <!-- ì´ìš© ì•ˆë‚´ -->
    <div class="mt-6 card p-4">
        <h3 class="font-medium text-gray-900 mb-3">ì´ìš© ì•ˆë‚´</h3>
        <ul class="text-sm text-gray-600 space-y-2">
            <li class="flex items-start space-x-2">
                <span class="text-blue-500 mt-0.5">â€¢</span>
                <span>ìš”ì²­ ì œì¶œ í›„ ê´€ë¦¬ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>
            </li>
            <li class="flex items-start space-x-2">
                <span class="text-blue-500 mt-0.5">â€¢</span>
                <span>ê¸‰í•œ ê²½ìš° ë„ì¥ìœ¼ë¡œ ì§ì ‘ ì—°ë½í•´ì£¼ì„¸ìš”.</span>
            </li>
            <li class="flex items-start space-x-2">
                <span class="text-blue-500 mt-0.5">â€¢</span>
                <span>ìŠ¹ì¸ëœ ìš”ì²­ì€ ë‹¹ì¼ ìš´í–‰ ëª…ë‹¨ì— ë°˜ì˜ë©ë‹ˆë‹¤.</span>
            </li>
        </ul>
    </div>
</div>

<script>
// ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
document.getElementById('start_date').valueAsDate = new Date();

// ìš”ì²­ ìœ í˜•ì— ë”°ë¥¸ ì‚¬ìœ  ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
document.querySelectorAll('input[name="request_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const reasonSection = document.getElementById('reasonSection');
        const reasonSelect = document.getElementById('reason');
        
        if (this.value === 'absence') {
            reasonSection.classList.remove('hidden');
            reasonSelect.required = true;
        } else {
            reasonSection.classList.add('hidden');
            reasonSelect.required = false;
            reasonSelect.value = '';
        }
    });
});

// ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ ì´í›„ë¡œë§Œ ì„ íƒ ê°€ëŠ¥
document.getElementById('start_date').addEventListener('change', function() {
    const endDateInput = document.getElementById('end_date');
    endDateInput.min = this.value;
    
    // ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ì´ˆê¸°í™”
    if (endDateInput.value && endDateInput.value < this.value) {
        endDateInput.value = '';
    }
});
</script>
{% endblock %} 